import{G as v,Q as xe,L as fe,T as pe,r,I as e,O as ye,K as A,X as be,W as Y}from"./index-B9naN4yU.js";import{c as F}from"./index-D7rrFXLk.js";import{A as we}from"./arrow-left-NsoeWyT4.js";import{A as ve}from"./arrow-right-BbdT2d6y.js";/**
 * @license lucide-react v0.503.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16",key:"qmtpty"}],["path",{d:"M9.5 4h5L17 7h3a2 2 0 0 1 2 2v7.5",key:"1ufyfc"}],["path",{d:"M14.121 15.121A3 3 0 1 1 9.88 10.88",key:"11zox6"}]],Ne=v("camera-off",je);/**
 * @license lucide-react v0.503.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ke=[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]],Z=v("camera",ke);/**
 * @license lucide-react v0.503.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Se=[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M18.89 13.23A7.12 7.12 0 0 0 19 12v-2",key:"80xlxr"}],["path",{d:"M5 10v2a7 7 0 0 0 12 5",key:"p2k8kg"}],["path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33",key:"1gzdoj"}],["path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12",key:"r2i35w"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]],Ae=v("mic-off",Se);/**
 * @license lucide-react v0.503.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Me=[["path",{d:"m11 7.601-5.994 8.19a1 1 0 0 0 .1 1.298l.817.818a1 1 0 0 0 1.314.087L15.09 12",key:"80a601"}],["path",{d:"M16.5 21.174C15.5 20.5 14.372 20 13 20c-2.058 0-3.928 2.356-6 2-2.072-.356-2.775-3.369-1.5-4.5",key:"j0ngtp"}],["circle",{cx:"16",cy:"7",r:"5",key:"d08jfb"}]],Ce=v("mic-vocal",Me);/**
 * @license lucide-react v0.503.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ie=[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z",key:"131961"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]],Te=v("mic",Ie);/**
 * @license lucide-react v0.503.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ee=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],ze=v("send",Ee),qe=()=>{const{jobId:z}=xe(),j=fe(),B=pe(),{userId:P}=B.state||{},[c,ee]=r.useState([]),[n,O]=r.useState(0),[g,M]=r.useState(!1),[C,$]=r.useState(!1),[se,R]=r.useState(!0),[U,Q]=r.useState(!1),[y,N]=r.useState(null),[Pe,te]=r.useState(!1),[re,D]=r.useState(!0),[_,H]=r.useState(null),[x,b]=r.useState([]),[l,V]=r.useState(null),u=r.useRef(null),[G,I]=r.useState(null),[k,J]=r.useState(!1),[f,p]=r.useState(!1),[W,d]=r.useState(null),[T,h]=r.useState(""),[E,q]=r.useState(""),a=r.useRef(null);r.useEffect(()=>{U&&(async()=>{var t,i;try{D(!0);const o=await Y.get(`/api/v1/mock-questions/job/${z}/user/${P}`,{withCredentials:!0});if(o.data&&Array.isArray(o.data)){const m=o.data.slice(0,5);ee(m),b(new Array(m.length).fill(""))}else console.error("Invalid questions data:",o.data),H("Invalid questions data received")}catch(o){console.error("Error fetching questions:",o),H(((i=(t=o.response)==null?void 0:t.data)==null?void 0:i.message)||"Failed to load questions")}finally{D(!1)}})()},[z,P,U]),r.useEffect(()=>{l&&u.current&&(u.current.srcObject=l)},[l]);const X=async()=>{J(!0),I(null);try{const s=await navigator.mediaDevices.getUserMedia({video:{width:{ideal:1280},height:{ideal:720}},audio:!0});V(s),R(!1),Q(!0),$(!0),u.current&&(u.current.srcObject=s,await u.current.play())}catch(s){if(console.error("Error accessing media devices:",s),s.name==="AbortError"||s.name==="NotAllowedError")try{const t=await navigator.mediaDevices.getUserMedia({video:{width:{ideal:1280},height:{ideal:720}}});V(t),R(!1),Q(!0),$(!0),u.current&&(u.current.srcObject=t,await u.current.play())}catch(t){console.error("Error accessing video only:",t),I("Unable to access camera. Please check your camera permissions and try again.")}else I("Unable to access media devices. Please check your permissions and try again.")}finally{J(!1)}},ne=async()=>{await X()},ie=()=>{R(!1),Q(!1),I("Camera and microphone access is required for the mock interview."),j("/jobs")},ae=async()=>{if(!C)await X();else if(l){const s=l.getVideoTracks()[0];s&&(s.enabled=!1,$(!1))}},oe=()=>{if(l){const s=l.getAudioTracks()[0];s&&(s.enabled=!s.enabled,M(!g),N(g?null:120))}};r.useEffect(()=>()=>{l&&l.getTracks().forEach(s=>s.stop())},[l]),r.useEffect(()=>{let s;return g&&y>0?s=setTimeout(()=>{N(y-1)},1e3):y===0&&M(!1),()=>clearTimeout(s)},[g,y]);const ce=s=>{const t=[...x];t[n]=s.target.value,b(t),te(!0)},L=async(s,t)=>{try{const i=x[n]||"";if(!i.trim())return F.error("Please provide an answer before submitting"),!1;if((await Y.post("/api/v1/user-answers/submit",{mockQuestionId:s,userId:P,userAnswer:i},{withCredentials:!0})).status===200)return F.success("Answer submitted successfully!"),!0}catch(i){return console.error("Error submitting answer:",i),F.error("Failed to submit answer. Please try again."),!1}},le=async()=>{if(n<c.length-1){const s=[...x],t=E+T;s[n]=t,b(s);const i=c[n];await L(i.id)&&(q(""),h(""),p(!1),a.current&&a.current.stop(),O(n+1),M(!1),N(null))}else{const s=[...x],t=E+T;s[n]=t,b(s);const i=c[n];await L(i.id)&&(a.current&&a.current.stop(),j(`/feedback/${z}`,{state:{answers:s,questions:c}}))}},de=async()=>{if(n>0){const s=[...x],t=E+T;s[n]=t,b(s);const i=c[n];await L(i.id)&&(q(""),h(""),p(!1),a.current&&a.current.stop(),O(n-1),M(!1),N(null))}},ue=()=>f?E+T:x[n]||"",me=s=>{const t=Math.floor(s/60),i=s%60;return`${t}:${i<10?"0":""}${i}`},w=c[n],he=(n+1)/c.length*100;r.useEffect(()=>{if("webkitSpeechRecognition"in window||"SpeechRecognition"in window){const s=window.SpeechRecognition||window.webkitSpeechRecognition;a.current=new s,a.current.continuous=!0,a.current.interimResults=!0,a.current.lang="en-US",a.current.onstart=()=>{console.log("Speech recognition started"),p(!0),d(null)},a.current.onresult=t=>{console.log("Speech recognition result:",t);let i="",o="";for(let m=t.resultIndex;m<t.results.length;m++){const S=t.results[m][0].transcript;t.results[m].isFinal?o+=S+" ":i+=S}i&&h(i),o&&q(m=>{const S=m+o,K=[...x];return K[n]=S,b(K),S})},a.current.onerror=t=>{switch(console.error("Speech recognition error:",t.error),t.error){case"no-speech":d("No speech detected. Please speak louder or check your microphone.");break;case"audio-capture":d("No microphone detected. Please check your microphone connection.");break;case"not-allowed":d("Microphone access denied. Please allow microphone access.");break;case"network":d("Network error occurred. Please check your internet connection.");break;default:d(`Speech recognition error: ${t.error}`)}p(!1),h("")},a.current.onend=()=>{if(console.log("Speech recognition ended"),f)try{a.current.start()}catch(t){console.error("Error restarting speech recognition:",t),p(!1)}else h("")}}},[]);const ge=()=>{if(!a.current){d("Speech recognition is not supported in your browser");return}try{f?(a.current.stop(),p(!1),h("")):(d(null),h(""),navigator.mediaDevices.getUserMedia({audio:!0}).then(()=>{a.current.start()}).catch(s=>{console.error("Microphone permission error:",s),d("Please allow microphone access to use speech recognition.")}))}catch(s){console.error("Speech recognition error:",s),d("Failed to start speech recognition. Please try again."),p(!1),h("")}};return _?e.jsx("div",{className:"min-h-screen bg-gray-100 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Error"}),e.jsx("p",{className:"text-gray-600",children:_}),e.jsx("button",{onClick:()=>j("/jobs"),className:"mt-4 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700",children:"Return to Jobs"})]})}):!re&&!_&&c.length===0?e.jsx("div",{className:"min-h-screen bg-gray-100 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"No Questions Available"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"There are no mock interview questions available for this job."}),e.jsx("button",{onClick:()=>j("/jobs"),className:"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700",children:"Return to Jobs"})]})}):e.jsxs("div",{className:"min-h-screen bg-gray-100 pt-16",children:[e.jsx(ye,{children:se&&e.jsx(A.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:e.jsxs(A.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},className:"bg-white rounded-xl p-6 max-w-md w-full",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Camera & Microphone Access"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"AIpply needs access to your camera and microphone to conduct the mock interview. This helps create a realistic interview experience."}),G&&e.jsx("div",{className:"mb-4 p-3 bg-red-50 text-red-600 rounded-lg",children:G}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsx("button",{onClick:ne,disabled:k,className:`flex-1 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors ${k?"opacity-50 cursor-not-allowed":""}`,children:k?"Initializing...":"Allow Access"}),e.jsx("button",{onClick:ie,disabled:k,className:`flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors ${k?"opacity-50 cursor-not-allowed":""}`,children:"Continue Without Access"})]})]})})}),e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-600",children:["Question ",n+1," of ",c.length]}),e.jsxs("button",{onClick:()=>j("/jobs"),className:"text-sm text-indigo-600 hover:text-indigo-800 flex items-center",children:[e.jsx(be,{size:16,className:"mr-1"}),"Exit Interview"]})]}),e.jsx("div",{className:"h-2 bg-gray-200 rounded-full overflow-hidden",children:e.jsx(A.div,{initial:{width:`${n/c.length*100}%`},animate:{width:`${he}%`},className:"h-full bg-indigo-600"})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-md overflow-hidden",children:[e.jsxs("div",{className:"relative aspect-video bg-gray-900 flex items-center justify-center",children:[C&&l?e.jsx("video",{ref:u,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-full object-cover",style:{transform:"scaleX(-1)"}}):e.jsxs("div",{className:"text-white text-center p-4",children:[e.jsx(Z,{size:48,className:"mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"Camera is off"})]}),g&&e.jsxs("div",{className:"absolute top-4 right-4 bg-red-600 text-white px-2 py-1 rounded-full text-sm flex items-center",children:[e.jsx("span",{className:"animate-pulse mr-1",children:"●"}),y!==null&&me(y)]})]}),e.jsxs("div",{className:"p-4 flex justify-center space-x-4",children:[e.jsx("button",{onClick:oe,className:`p-3 rounded-full ${g?"bg-red-100 text-red-600":"bg-gray-100 text-gray-600"} hover:bg-gray-200 transition-colors`,children:g?e.jsx(Ae,{size:20}):e.jsx(Te,{size:20})}),e.jsx("button",{onClick:ae,className:"p-3 rounded-full bg-gray-100 text-gray-600 hover:bg-gray-200 transition-colors",children:C?e.jsx(Z,{size:20}):e.jsx(Ne,{size:20})})]})]})}),e.jsx("div",{className:"lg:col-span-2",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-md h-full flex flex-col",children:[e.jsxs("div",{className:"p-6 border-b",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:["Question ",n+1]}),e.jsx("p",{className:"text-gray-700",children:w==null?void 0:w.question}),e.jsx("div",{className:"mt-4 bg-indigo-50 border border-indigo-100 rounded-lg p-3",children:e.jsxs("p",{className:"text-sm text-indigo-800",children:[e.jsx("span",{className:"font-medium",children:"Hint:"})," ",w==null?void 0:w.hint]})})]}),e.jsxs("div",{className:"p-6 flex-grow flex flex-col",children:[e.jsxs("div",{className:"flex-grow",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("label",{htmlFor:"answer",className:"block text-sm font-medium text-gray-700",children:"Your Answer"}),e.jsx("button",{onClick:ge,className:`p-2 rounded-full ${f?"bg-red-100 text-red-600":"bg-gray-100 text-gray-600 hover:bg-gray-200"} transition-colors`,title:f?"Stop recording":"Start recording",children:e.jsx(Ce,{size:20,className:f?"animate-pulse":""})})]}),W&&e.jsx("div",{className:"mb-2 p-2 bg-red-50 text-red-600 text-sm rounded-lg",children:W}),e.jsxs("div",{className:"relative",children:[e.jsx("textarea",{id:"answer",value:ue(),onChange:ce,placeholder:"Type your answer here or use the microphone to record...",className:"w-full h-40 p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent resize-none"}),f&&e.jsx("div",{className:"absolute bottom-2 right-2 flex items-center space-x-2",children:e.jsx("span",{className:"animate-pulse text-red-500 text-sm",children:"Recording..."})})]})]}),e.jsxs("div",{className:"mt-6 flex justify-between",children:[e.jsxs(A.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:de,disabled:n===0,className:`flex items-center px-4 py-2 rounded-lg ${n===0?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-gray-100 text-gray-700 hover:bg-gray-200"} transition-colors`,children:[e.jsx(we,{size:18,className:"mr-2"}),"Previous"]}),e.jsx(A.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:le,className:"flex items-center px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors",children:n<c.length-1?e.jsxs(e.Fragment,{children:["Next",e.jsx(ve,{size:18,className:"ml-2"})]}):e.jsxs(e.Fragment,{children:["Finish Interview",e.jsx(ze,{size:18,className:"ml-2"})]})})]})]})]})})]})]})]})};export{qe as default};
